<!DOCTYPE html>
<html>

<head>
    <meta name="author" content="Abhisek">
    <meta name="description" content="Expense Tracker Application">
    <title>Expense Tracker</title>

    <!-- Bootstrap 5 CSS -->
    <link href="/Expense Tracker/vendor/bootsrap/bootstrap.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a href="#" class="navbar-brand">
                <img src="Expense PNG.webp" alt="logo" width="80">
            </a>
            <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar">
                <i class="bi bi-list"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbar">
                <div class="navbar-nav ms-auto">
                    Home
                </div>
            </div>
        </div>
    </nav>

    <!-- Top section -->
    <div class="container mt-5">
        <div class="float-end">
            <!-- Trigger Modal -->
            <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal"
                data-bs-target="#addExpenseModal">
                Add Expense
            </button>
        </div>
        <div class="float-start">
            <label class="text-success"><b>Total Spent:</b></label>
            <b id="totalSpent">0</b>
        </div>
    </div>

    <!-- Expense Table -->
    <div class="container py-5 px-5">
        <div class="d-flex justify-content-center">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <table class="table table-bordered">
                            <thead class="text-center table-light">
                                <tr>
                                    <th>#</th>
                                    <th>Description</th>
                                    <th>Date</th>
                                    <th>Spent Amount</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody class="text-center" id="expenseTableBody">
                                <tr>
                                    <td colspan="5" class="text-center">No Expense Details Added Yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="addExpenseModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="addExpenseModalLabel" aria-hidden="true">
        <form id="addExpenseForm">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addExpenseModalLabel">Add Expense</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-1">
                            <label for="addExpenseDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="addExpenseDescription" name="Description" rows="3"
                                placeholder="Add your Expense Description"></textarea>
                        </div>
                        <div class="mb-1">
                            <label for="addExpenseExpenditureDate" class="form-label">Expenditure Date</label>
                            <input type="date" class="form-control" id="addExpenseExpenditureDate" name="Date">
                        </div>
                        <div class="mb-1">
                            <label for="addExpenseSpentAmount" class="form-label">Spent Amount</label>
                            <input type="number" class="form-control" id="addExpenseSpentAmount" name="Spent"
                                placeholder="Enter Amount">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="saveExpense()">Save Expense</button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- Bootstrap Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Load table on start
        createTableFromJSON();

        // Save expense to localStorage
        function saveExpense() {
            var form = document.getElementById("addExpenseForm");
            var expenseObject = {
                id: Date.now(), // unique ID for deletion
                Description: form.Description.value,
                Date: form.Date.value,
                Spent: form.Spent.value
            };

            var storageObjectArr = [];
            var storageObject = localStorage.getItem("expenseStorage");

            if (storageObject) {
                storageObjectArr = JSON.parse(storageObject);
            }
            storageObjectArr.push(expenseObject);

            localStorage.setItem("expenseStorage", JSON.stringify(storageObjectArr));

            // Refresh table
            createTableFromJSON();

            // Reset form
            form.reset();

            // Close modal
            var modalEl = document.getElementById('addExpenseModal');
            var modal = bootstrap.Modal.getInstance(modalEl);
            modal.hide();
        }

        // Delete expense
        function deleteExpense(id) {
            var storageObject = localStorage.getItem("expenseStorage");
            var storageObjectArr = [];

            if (storageObject) {
                storageObjectArr = JSON.parse(storageObject);
            }

            // remove item by id
            storageObjectArr = storageObjectArr.filter(exp => exp.id !== id);

            localStorage.setItem("expenseStorage", JSON.stringify(storageObjectArr));

            // Refresh table
            createTableFromJSON();
        }

        // Create table from localStorage
        function createTableFromJSON() {
            var storageObject = localStorage.getItem('expenseStorage');
            var storageObjectArr = [];

            if (storageObject) {
                storageObjectArr = JSON.parse(storageObject);
            }

            var html = "";
            var total = 0;

            if (storageObjectArr.length > 0) {
                for (let i in storageObjectArr) {
                    var date = new Date(storageObjectArr[i]['Date']);
                    total += parseFloat(storageObjectArr[i]['Spent']) || 0;

                    html += '<tr>'
                        + '<td>' + (parseInt(i) + 1) + '</td>'
                        + '<td>' + storageObjectArr[i]['Description'] + '</td>'
                        + '<td>' + date.toDateString() + '</td>'
                        + '<td>' + storageObjectArr[i]['Spent'] + '</td>'
                        + '<td><button class="btn btn-danger btn-sm" onclick="deleteExpense(' + storageObjectArr[i]['id'] + ')">Delete</button></td>'
                        + '</tr>';
                }
            } else {
                html = '<tr><td colspan="5" class="text-center">No Expense Details Added Yet</td></tr>';
            }

            document.getElementById("expenseTableBody").innerHTML = html;
            document.getElementById("totalSpent").innerText = total;
        }
    </script>
</body>

</html>